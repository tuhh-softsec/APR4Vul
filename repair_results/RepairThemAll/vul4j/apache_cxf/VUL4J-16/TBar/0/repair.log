cd /workdir/TBar_vul4j_apache_cxf_VUL4J-16;
export JAVA_TOOL_OPTIONS="-Dfile.encoding=UTF8 -Duser.language=en-US -Duser.country=US -Duser.language=en";
TZ="America/New_York"; export TZ;
export PATH="/usr/lib/jvm/java-8-openjdk-amd64/bin:$PATH";
export JAVA_HOME="/usr/lib/jvm/java-8-openjdk-amd64";
timeout 240m java -Xmx4g -Xms1g -XX:MaxPermSize=512m \
    -cp /script/../libs/tbar_external/com.gzoltar-0.1.1-jdk7.jar:/script/../repair_tools/tbar.jar edu.lu.uni.serval.tbar.main.Main \
    "/workdir/TBar_vul4j_apache_cxf_VUL4J-16" "org.apache.cxf.rs.security.saml.sso.CombinedValidatorTest#testWrappingAttack3" "/rt/rs/security/sso/saml/src/main/java/" "/rt/rs/security/sso/saml/src/test/java/" "/rt/rs/security/sso/saml/target/classes/" "/rt/rs/security/sso/saml/target/test-classes/" "/script/../data/benchmarks/vul4j/perfectfl/VUL4J-16/spectra.txt" "mvn -pl rt/rs/security/sso/saml -Dtest=org.apache.cxf.rs.security.saml.sso.CombinedValidatorTest#testWrappingAttack3 test -Dhttps.protocols=TLSv1.2 -Denforcer.skip=true -Dcheckstyle.skip=true -Dcobertura.skip=true -DskipITs=true -Drat.skip=true -Dlicense.skip=true -Dpmd.skip=true -Dfindbugs.skip=true -Dgpg.skip=true -Dskip.npm=true -Dskip.gulp=true -Dskip.bower=true -Danimal.sniffer.skip=true -V -B" "mvn -pl rt/rs/security/sso/saml -Dhttps.protocols=TLSv1.2 -Denforcer.skip=true -Dcheckstyle.skip=true -Dcobertura.skip=true -DskipITs=true -Drat.skip=true -Dlicense.skip=true -Dpmd.skip=true -Dfindbugs.skip=true -Dgpg.skip=true -Dskip.npm=true -Dskip.gulp=true -Dskip.bower=true -Danimal.sniffer.skip=true -V -B" "/workdir/TBar_vul4j_apache_cxf_VUL4J-16/rt/rs/security/sso/saml/target/classes:/root/.m2/repository/org/apache/geronimo/specs/geronimo-javamail_1.4_spec/1.7.1/geronimo-javamail_1.4_spec-1.7.1.jar:/root/.m2/repository/org/apache/wss4j/wss4j-ws-security-common/2.1.2/wss4j-ws-security-common-2.1.2.jar:/root/.m2/repository/org/apache/cxf/cxf-rt-security/3.1.3-SNAPSHOT/cxf-rt-security-3.1.3-SNAPSHOT.jar:/root/.m2/repository/org/opensaml/opensaml-xmlsec-api/3.1.1/opensaml-xmlsec-api-3.1.1.jar:/root/.m2/repository/org/codehaus/woodstox/woodstox-core-asl/4.4.1/woodstox-core-asl-4.4.1.jar:/root/.m2/repository/org/opensaml/opensaml-soap-api/3.1.1/opensaml-soap-api-3.1.1.jar:/root/.m2/repository/org/apache/geronimo/specs/geronimo-servlet_3.0_spec/1.0/geronimo-servlet_3.0_spec-1.0.jar:/root/.m2/repository/org/slf4j/slf4j-api/1.7.12/slf4j-api-1.7.12.jar:/root/.m2/repository/javax/ws/rs/javax.ws.rs-api/2.0.1/javax.ws.rs-api-2.0.1.jar:/root/.m2/repository/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar:/root/.m2/repository/org/cryptacular/cryptacular/1.0/cryptacular-1.0.jar:/root/.m2/repository/org/apache/wss4j/wss4j-ws-security-dom/2.1.2/wss4j-ws-security-dom-2.1.2.jar:/root/.m2/repository/org/apache/cxf/cxf-core/3.1.3-SNAPSHOT/cxf-core-3.1.3-SNAPSHOT.jar:/root/.m2/repository/org/opensaml/opensaml-xmlsec-impl/3.1.1/opensaml-xmlsec-impl-3.1.1.jar:/root/.m2/repository/org/apache/cxf/cxf-rt-rs-security-xml/3.1.3-SNAPSHOT/cxf-rt-rs-security-xml-3.1.3-SNAPSHOT.jar:/root/.m2/repository/org/opensaml/opensaml-saml-api/3.1.1/opensaml-saml-api-3.1.1.jar:/root/.m2/repository/net/shibboleth/utilities/java-support/7.1.1/java-support-7.1.1.jar:/root/.m2/repository/org/apache/santuario/xmlsec/2.0.5/xmlsec-2.0.5.jar:/root/.m2/repository/com/google/guava/guava/18.0/guava-18.0.jar:/root/.m2/repository/org/jasypt/jasypt/1.9.2/jasypt-1.9.2.jar:/root/.m2/repository/net/sf/ehcache/ehcache/2.9.0/ehcache-2.9.0.jar:/root/.m2/repository/org/opensaml/opensaml-security-api/3.1.1/opensaml-security-api-3.1.1.jar:/root/.m2/repository/org/apache/cxf/cxf-rt-transports-http/3.1.3-SNAPSHOT/cxf-rt-transports-http-3.1.3-SNAPSHOT.jar:/root/.m2/repository/org/opensaml/opensaml-security-impl/3.1.1/opensaml-security-impl-3.1.1.jar:/root/.m2/repository/commons-codec/commons-codec/1.10/commons-codec-1.10.jar:/root/.m2/repository/org/opensaml/opensaml-xacml-saml-impl/3.1.1/opensaml-xacml-saml-impl-3.1.1.jar:/root/.m2/repository/org/opensaml/opensaml-core/3.1.1/opensaml-core-3.1.1.jar:/root/.m2/repository/org/opensaml/opensaml-xacml-impl/3.1.1/opensaml-xacml-impl-3.1.1.jar:/root/.m2/repository/joda-time/joda-time/2.7/joda-time-2.7.jar:/root/.m2/repository/org/codehaus/woodstox/stax2-api/3.1.4/stax2-api-3.1.4.jar:/root/.m2/repository/org/apache/cxf/cxf-rt-security-saml/3.1.3-SNAPSHOT/cxf-rt-security-saml-3.1.3-SNAPSHOT.jar:/root/.m2/repository/org/opensaml/opensaml-xacml-saml-api/3.1.1/opensaml-xacml-saml-api-3.1.1.jar:/root/.m2/repository/junit/junit/4.12/junit-4.12.jar:/root/.m2/repository/org/apache/ws/xmlschema/xmlschema-core/2.2.1/xmlschema-core-2.2.1.jar:/root/.m2/repository/org/apache/cxf/cxf-rt-frontend-jaxrs/3.1.3-SNAPSHOT/cxf-rt-frontend-jaxrs-3.1.3-SNAPSHOT.jar:/root/.m2/repository/org/opensaml/opensaml-xacml-api/3.1.1/opensaml-xacml-api-3.1.1.jar:/root/.m2/repository/org/opensaml/opensaml-profile-api/3.1.1/opensaml-profile-api-3.1.1.jar:/root/.m2/repository/javax/annotation/javax.annotation-api/1.2/javax.annotation-api-1.2.jar:/root/.m2/repository/org/opensaml/opensaml-saml-impl/3.1.1/opensaml-saml-impl-3.1.1.jar:/root/.m2/repository/org/bouncycastle/bcprov-jdk15on/1.52/bcprov-jdk15on-1.52.jar";
echo "\n\nNode: `hostname`\n";
echo "\n\nDate: `date`\n";
Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF8 -Duser.language=en-US -Duser.country=US -Duser.language=en
OpenJDK 64-Bit Server VM warning: ignoring option MaxPermSize=512m; support was removed in 8.0
06:52:08,813 |-INFO in ch.qos.logback.classic.LoggerContext[TBar] - Could NOT find resource [logback-test.xml]
06:52:08,813 |-INFO in ch.qos.logback.classic.LoggerContext[TBar] - Could NOT find resource [logback.groovy]
06:52:08,813 |-INFO in ch.qos.logback.classic.LoggerContext[TBar] - Found resource [logback.xml] at [jar:file:/repair_tools/tbar.jar!/logback.xml]
06:52:08,823 |-INFO in ch.qos.logback.core.joran.spi.ConfigurationWatchList@5a42bbf4 - URL [jar:file:/repair_tools/tbar.jar!/logback.xml] is not of type file
06:52:08,874 |-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - debug attribute not set
06:52:08,875 |-INFO in ch.qos.logback.classic.joran.action.ContextNameAction - Setting logger context name as [TBar]
06:52:08,875 |-INFO in ch.qos.logback.core.joran.action.AppenderAction - About to instantiate appender of type [ch.qos.logback.core.ConsoleAppender]
06:52:08,877 |-INFO in ch.qos.logback.core.joran.action.AppenderAction - Naming appender as [STDOUT]
06:52:08,916 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting level of logger [org.hibernate.engine.query.HQLQueryPlan] to DEBUG
06:52:08,916 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting additivity of logger [org.hibernate.engine.query.HQLQueryPlan] to false
06:52:08,916 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting level of logger [com.piedra.logback] to DEBUG
06:52:08,916 |-ERROR in ch.qos.logback.core.joran.action.AppenderRefAction - Could not find an appender named [FILE]. Did you define it below instead of above in the configuration file?
06:52:08,916 |-ERROR in ch.qos.logback.core.joran.action.AppenderRefAction - See http://logback.qos.ch/codes.html#appender_order for more details.
06:52:08,916 |-INFO in ch.qos.logback.classic.joran.action.RootLoggerAction - Setting level of ROOT logger to DEBUG
06:52:08,917 |-INFO in ch.qos.logback.core.joran.action.AppenderRefAction - Attaching appender named [STDOUT] to Logger[ROOT]
06:52:08,917 |-ERROR in ch.qos.logback.core.joran.action.AppenderRefAction - Could not find an appender named [ROLLINGFILE]. Did you define it below instead of above in the configuration file?
06:52:08,917 |-ERROR in ch.qos.logback.core.joran.action.AppenderRefAction - See http://logback.qos.ch/codes.html#appender_order for more details.
06:52:08,917 |-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - End of configuration.
06:52:08,918 |-INFO in ch.qos.logback.classic.joran.JoranConfigurator@270421f5 - Registering current configuration as safe fallback point

2022-09-14 06:52:08.993 [main] INFO  edu.lu.uni.serval.tbar.AbstractFixer - TBar_vul4j_apache_cxf_VUL4J-16 Failed Tests: 1
2022-09-14 06:52:08.996 [main] INFO  edu.lu.uni.serval.tbar.TBarFixer - =======StaticBugFixer: Start to fix suspicious code======
2022-09-14 06:52:08.996 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - org.apache.cxf.rs.security.saml.sso.SAMLSSOResponseValidator ===143
2022-09-14 06:52:09.407 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Suspicious Code: 
Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
2022-09-14 06:52:12.943 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -140,10 +140,13 @@ public class SAMLSSOResponseValidator {
-        Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
+        if (samlResponse != null) {
+	Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
+	}
+
2022-09-14 06:52:12.943 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 06:52:13.691 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 06:52:21.215 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -140,7 +140,10 @@ public class SAMLSSOResponseValidator {
-        Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
+        if (samlResponse == null) {
+	    throw new IllegalArgumentException("Null 'samlResponse' argument.");
+	}
+Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
2022-09-14 06:52:21.216 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 06:52:21.982 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 06:52:28.889 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -140,7 +140,10 @@ public class SAMLSSOResponseValidator {
-        Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
+        if (samlResponse == null) {
+	    return null;
+	}
+Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
2022-09-14 06:52:28.889 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 06:52:29.715 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 06:52:37.190 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -140,7 +140,8 @@ public class SAMLSSOResponseValidator {
-        Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
+        if (samlResponse == null) samlResponse = new Response();
+ Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
2022-09-14 06:52:37.190 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 06:52:37.863 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - BuggyProject ---Fixer: fix fail because of failed compiling! 
2022-09-14 06:52:37.898 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -140,7 +140,8 @@ public class SAMLSSOResponseValidator {
-        Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
+        if (samlResponse == null) return new SSOValidatorResponse();
+	 Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
2022-09-14 06:52:37.899 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 06:52:38.595 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 06:52:46.694 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -140,7 +140,8 @@ public class SAMLSSOResponseValidator {
-        Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
+        if (samlResponse == null) return validatorResponse;
+	 Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
2022-09-14 06:52:46.695 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 06:52:47.527 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 06:52:55.701 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -140,7 +140,7 @@ public class SAMLSSOResponseValidator {
-        Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
+
2022-09-14 06:52:55.701 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 06:52:56.390 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - BuggyProject ---Fixer: fix fail because of failed compiling! 
2022-09-14 06:52:56.465 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -62,91 +62,7 @@ public class SAMLSSOResponseValidator {
-    /**
-     * Validate a SAML 2 Protocol Response
-     * @param samlResponse
-     * @param postBinding
-     * @return a SSOValidatorResponse object
-     * @throws WSSecurityException
-     */
-    public SSOValidatorResponse validateSamlResponse(
-        org.opensaml.saml.saml2.core.Response samlResponse,
-        boolean postBinding
-    ) throws WSSecurityException {
-        // Check the Issuer
-        validateIssuer(samlResponse.getIssuer());
-
-        // The Response must contain at least one Assertion.
-        if (samlResponse.getAssertions() == null || samlResponse.getAssertions().isEmpty()) {
-            LOG.fine("The Response must contain at least one Assertion");
-            throw new WSSecurityException(WSSecurityException.ErrorCode.FAILURE, "invalidSAMLsecurity");
-        }
-
-        // The Response must contain a Destination that matches the assertionConsumerURL if it is
-        // signed
-        String destination = samlResponse.getDestination();
-        if (samlResponse.isSigned()
-            && (destination == null || !destination.equals(assertionConsumerURL))) {
-            LOG.fine("The Response must contain a destination that matches the assertion consumer URL");
-            throw new WSSecurityException(WSSecurityException.ErrorCode.FAILURE, "invalidSAMLsecurity");
-        }
-
-        // Validate Assertions
-        boolean foundValidSubject = false;
-        Date sessionNotOnOrAfter = null;
-        for (org.opensaml.saml.saml2.core.Assertion assertion : samlResponse.getAssertions()) {
-            // Check the Issuer
-            if (assertion.getIssuer() == null) {
-                LOG.fine("Assertion Issuer must not be null");
-                throw new WSSecurityException(WSSecurityException.ErrorCode.FAILURE, "invalidSAMLsecurity");
-            }
-            validateIssuer(assertion.getIssuer());
-
-            if (enforceAssertionsSigned && postBinding && assertion.getSignature() == null) {
-                LOG.fine("If the HTTP Post binding is used to deliver the Response, "
-                         + "the enclosed assertions must be signed");
-                throw new WSSecurityException(WSSecurityException.ErrorCode.FAILURE, "invalidSAMLsecurity");
-            }
-
-            // Check for AuthnStatements and validate the Subject accordingly
-            if (assertion.getAuthnStatements() != null
-                && !assertion.getAuthnStatements().isEmpty()) {
-                org.opensaml.saml.saml2.core.Subject subject = assertion.getSubject();
-                if (validateAuthenticationSubject(subject, assertion.getID(), postBinding)) {
-                    validateAudienceRestrictionCondition(assertion.getConditions());
-                    foundValidSubject = true;
-                    // Store Session NotOnOrAfter
-                    for (AuthnStatement authnStatment : assertion.getAuthnStatements()) {
-                        if (authnStatment.getSessionNotOnOrAfter() != null) {
-                            sessionNotOnOrAfter = authnStatment.getSessionNotOnOrAfter().toDate();
-                        }
-                    }
-                }
-            }
-
-        }
-
-        if (!foundValidSubject) {
-            LOG.fine("The Response did not contain any Authentication Statement that matched "
-                     + "the Subject Confirmation criteria");
-            throw new WSSecurityException(WSSecurityException.ErrorCode.FAILURE, "invalidSAMLsecurity");
-        }
-
-        SSOValidatorResponse validatorResponse = new SSOValidatorResponse();
-        validatorResponse.setResponseId(samlResponse.getID());
-        validatorResponse.setSessionNotOnOrAfter(sessionNotOnOrAfter);
-        if (samlResponse.getIssueInstant() != null) {
-            validatorResponse.setCreated(samlResponse.getIssueInstant().toDate());
-        }
-
-        // the assumption for now is that SAMLResponse will contain only a single assertion
-        Element assertionElement = samlResponse.getAssertions().get(0).getDOM();
-        Element clonedAssertionElement = (Element)assertionElement.cloneNode(true);
-        validatorResponse.setAssertionElement(clonedAssertionElement);
-        validatorResponse.setAssertion(DOM2Writer.nodeToString(clonedAssertionElement));
-
-        return validatorResponse;
-    }
+
2022-09-14 06:52:56.465 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 06:52:57.209 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 06:53:04.529 [main] INFO  edu.lu.uni.serval.tbar.TBarFixer - =======StaticBugFixer: Finish off fixing======
Failed to fix bug


Node: ee2bf67284b9



Date: Wed Sep 14 06:53:04 EDT 2022

