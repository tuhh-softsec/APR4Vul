cd /workdir/TBar_vul4j_nahsra_antisamy_VUL4J-60;
export JAVA_TOOL_OPTIONS="-Dfile.encoding=UTF8 -Duser.language=en-US -Duser.country=US -Duser.language=en";
TZ="America/New_York"; export TZ;
export PATH="/usr/lib/jvm/java-8-openjdk-amd64/bin:$PATH";
export JAVA_HOME="/usr/lib/jvm/java-8-openjdk-amd64";
timeout 240m java -Xmx4g -Xms1g -XX:MaxPermSize=512m \
    -cp /script/../libs/tbar_external/com.gzoltar-0.1.1-jdk7.jar:/script/../repair_tools/tbar.jar edu.lu.uni.serval.tbar.main.Main \
    "/workdir/TBar_vul4j_nahsra_antisamy_VUL4J-60" "org.owasp.validator.html.test.AntiSamyTest#testIssue2" "/src/main/java/" "/src/test/java/" "/target/classes/" "/target/test-classes/" "/script/../data/benchmarks/vul4j/perfectfl/VUL4J-60/spectra.txt" "mvn test -Dtest=org.owasp.validator.html.test.AntiSamyTest#testIssue2 -Dhttps.protocols=TLSv1.2 -Denforcer.skip=true -Dcheckstyle.skip=true -Dcobertura.skip=true -DskipITs=true -Drat.skip=true -Dlicense.skip=true -Dpmd.skip=true -Dfindbugs.skip=true -Dgpg.skip=true -Dskip.npm=true -Dskip.gulp=true -Dskip.bower=true -Danimal.sniffer.skip=true -V -B" "mvn test -Dhttps.protocols=TLSv1.2 -Denforcer.skip=true -Dcheckstyle.skip=true -Dcobertura.skip=true -DskipITs=true -Drat.skip=true -Dlicense.skip=true -Dpmd.skip=true -Dfindbugs.skip=true -Dgpg.skip=true -Dskip.npm=true -Dskip.gulp=true -Dskip.bower=true -Danimal.sniffer.skip=true -V -B" "/root/.m2/repository/org/apache/xmlgraphics/batik-ext/1.8/batik-ext-1.8.jar:/root/.m2/repository/org/apache/xmlgraphics/batik-util/1.8/batik-util-1.8.jar:/root/.m2/repository/org/apache/xmlgraphics/batik-css/1.8/batik-css-1.8.jar:/root/.m2/repository/xml-apis/xml-apis-ext/1.3.04/xml-apis-ext-1.3.04.jar:/root/.m2/repository/commons-logging/commons-logging/1.0.4/commons-logging-1.0.4.jar:/root/.m2/repository/junit/junit/4.12/junit-4.12.jar:/root/.m2/repository/xml-apis/xml-apis/1.4.01/xml-apis-1.4.01.jar:/root/.m2/repository/xerces/xercesImpl/2.11.0/xercesImpl-2.11.0.jar:/root/.m2/repository/commons-httpclient/commons-httpclient/3.1/commons-httpclient-3.1.jar:/root/.m2/repository/net/sourceforge/nekohtml/nekohtml/1.9.22/nekohtml-1.9.22.jar:/root/.m2/repository/commons-codec/commons-codec/1.2/commons-codec-1.2.jar:/root/.m2/repository/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar";
echo "\n\nNode: `hostname`\n";
echo "\n\nDate: `date`\n";
Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF8 -Duser.language=en-US -Duser.country=US -Duser.language=en
OpenJDK 64-Bit Server VM warning: ignoring option MaxPermSize=512m; support was removed in 8.0
17:23:45,460 |-INFO in ch.qos.logback.classic.LoggerContext[TBar] - Could NOT find resource [logback-test.xml]
17:23:45,460 |-INFO in ch.qos.logback.classic.LoggerContext[TBar] - Could NOT find resource [logback.groovy]
17:23:45,460 |-INFO in ch.qos.logback.classic.LoggerContext[TBar] - Found resource [logback.xml] at [jar:file:/repair_tools/tbar.jar!/logback.xml]
17:23:45,470 |-INFO in ch.qos.logback.core.joran.spi.ConfigurationWatchList@5a42bbf4 - URL [jar:file:/repair_tools/tbar.jar!/logback.xml] is not of type file
17:23:45,504 |-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - debug attribute not set
17:23:45,505 |-INFO in ch.qos.logback.classic.joran.action.ContextNameAction - Setting logger context name as [TBar]
17:23:45,505 |-INFO in ch.qos.logback.core.joran.action.AppenderAction - About to instantiate appender of type [ch.qos.logback.core.ConsoleAppender]
17:23:45,508 |-INFO in ch.qos.logback.core.joran.action.AppenderAction - Naming appender as [STDOUT]
17:23:45,557 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting level of logger [org.hibernate.engine.query.HQLQueryPlan] to DEBUG
17:23:45,557 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting additivity of logger [org.hibernate.engine.query.HQLQueryPlan] to false
17:23:45,557 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting level of logger [com.piedra.logback] to DEBUG
17:23:45,557 |-ERROR in ch.qos.logback.core.joran.action.AppenderRefAction - Could not find an appender named [FILE]. Did you define it below instead of above in the configuration file?
17:23:45,557 |-ERROR in ch.qos.logback.core.joran.action.AppenderRefAction - See http://logback.qos.ch/codes.html#appender_order for more details.
17:23:45,557 |-INFO in ch.qos.logback.classic.joran.action.RootLoggerAction - Setting level of ROOT logger to DEBUG
17:23:45,557 |-INFO in ch.qos.logback.core.joran.action.AppenderRefAction - Attaching appender named [STDOUT] to Logger[ROOT]
17:23:45,558 |-ERROR in ch.qos.logback.core.joran.action.AppenderRefAction - Could not find an appender named [ROLLINGFILE]. Did you define it below instead of above in the configuration file?
17:23:45,558 |-ERROR in ch.qos.logback.core.joran.action.AppenderRefAction - See http://logback.qos.ch/codes.html#appender_order for more details.
17:23:45,558 |-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - End of configuration.
17:23:45,559 |-INFO in ch.qos.logback.classic.joran.JoranConfigurator@270421f5 - Registering current configuration as safe fallback point

2022-09-14 17:23:45.635 [main] INFO  edu.lu.uni.serval.tbar.AbstractFixer - TBar_vul4j_nahsra_antisamy_VUL4J-60 Failed Tests: 1
2022-09-14 17:23:45.638 [main] INFO  edu.lu.uni.serval.tbar.TBarFixer - =======StaticBugFixer: Start to fix suspicious code======
2022-09-14 17:23:45.638 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - org.owasp.validator.html.scan.MagicSAXFilter ===274
2022-09-14 17:23:46.177 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Suspicious Code: 
if (isStyle) {
				this.operations.push(Ops.CSS);
				cssContent = new StringBuffer();
				cssAttributes = attributes;
			} else {
				// validate all attributes, we need to do this now to find out
				// how to deal with the element
				boolean removeTag = false;
				boolean filterTag = false;
				for (int i = 0; i < attributes.getLength(); i++) {
					String name = attributes.getQName(i);
					String value = attributes.getValue(i);
					String nameLower = name.toLowerCase();
					Attribute attribute = tag.getAttributeByName(nameLower);
					if (attribute == null) {
						// no policy defined, perhaps it is a global attribute
						attribute = policy.getGlobalAttributeByName(nameLower);
					}
					// boolean isAttributeValid = false;
					if ("style".equalsIgnoreCase(name)) {
						CssScanner styleScanner = makeCssScanner();
						try {
							CleanResults cr = styleScanner.scanInlineStyle(value, element.localpart, maxInputSize);
							attributes.setValue(i, cr.getCleanHTML());
							validattributes.addAttribute(makeSimpleQname(name), "CDATA", cr.getCleanHTML());
							errorMessages.addAll(cr.getErrorMessages());
						} catch (ScanException e) {
							addError(ErrorMessageUtil.ERROR_CSS_ATTRIBUTE_MALFORMED, new Object[] {
									element.localpart, HTMLEntityEncoder.htmlEntityEncode(value)
							});
						}
					} else if (attribute != null) {
						// validate the values against the policy
						boolean isValid = false;
                        if (attribute.containsAllowedValue(value.toLowerCase())) {
                            validattributes.addAttribute(makeSimpleQname(name), "CDATA", value);
                            isValid = true;
                        }


                        if (!isValid) {
                            isValid = attribute.matchesAllowedExpression(value);
                            if (isValid) {
                                validattributes.addAttribute(makeSimpleQname(name), "CDATA", value);
                            }
                        }


                        // if value or regexp matched, attribute is already
						// copied, but what happens if not
						if (!isValid && "removeTag".equals(attribute.getOnInvalid())) {
							
							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_INVALID_REMOVED,
								new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
							
							removeTag = true;
							
						} else if (!isValid && ("filterTag".equals(attribute.getOnInvalid()) || masqueradingParam)) {
							
							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_CAUSE_FILTER, 
								new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
							
							filterTag = true;
							
						} else if (!isValid) {
							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_INVALID, new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
						}
						
					} else { // attribute == null
						addError(ErrorMessageUtil.ERROR_ATTRIBUTE_NOT_IN_POLICY, new Object[] {
								element.localpart, HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value)
						});
						
						if (masqueradingParam) {
							filterTag = true;
						}
					}
				}

				if (removeTag) {
					this.operations.push(Ops.REMOVE);
				} else if (filterTag) {
					this.operations.push(Ops.FILTER);
				} else {

					if (isNofollowAnchors && "a".equals(element.localpart)) {
						validattributes.addAttribute(makeSimpleQname("rel"), "CDATA", "nofollow");
					}

					if (masqueradingParam) {
						validattributes = new XMLAttributesImpl();
						validattributes.addAttribute(makeSimpleQname("name"), "CDATA", embedName);
						validattributes.addAttribute(makeSimpleQname("value"), "CDATA", embedValue);
					}

					this.operations.push(Ops.KEEP);
				}
			}
2022-09-14 17:23:47.179 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != masqueradingParam && (isStyle)) {
2022-09-14 17:23:47.180 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:23:47.925 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:23:50.935 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != masqueradingParam || (isStyle)) {
2022-09-14 17:23:50.935 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:23:51.657 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:23:54.838 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == masqueradingParam && (isStyle)) {
2022-09-14 17:23:54.838 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:23:55.559 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:23:58.532 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:24:10.441 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == masqueradingParam || (isStyle)) {
2022-09-14 17:24:10.441 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:24:11.175 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:24:14.222 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.isNofollowAnchors && (isStyle)) {
2022-09-14 17:24:14.222 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:24:14.923 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:24:18.562 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:24:29.923 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.isNofollowAnchors || (isStyle)) {
2022-09-14 17:24:29.923 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:24:30.610 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:24:33.694 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.isNofollowAnchors && (isStyle)) {
2022-09-14 17:24:33.694 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:24:34.367 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:24:37.556 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.isNofollowAnchors || (isStyle)) {
2022-09-14 17:24:37.557 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:24:38.224 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:24:41.395 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.isValidateParamAsEmbed && (isStyle)) {
2022-09-14 17:24:41.395 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:24:42.098 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:24:45.125 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:24:56.356 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.isValidateParamAsEmbed || (isStyle)) {
2022-09-14 17:24:56.356 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:24:57.103 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:00.263 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.isValidateParamAsEmbed && (isStyle)) {
2022-09-14 17:25:00.263 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:00.927 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:04.093 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.isValidateParamAsEmbed || (isStyle)) {
2022-09-14 17:25:04.093 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:04.777 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:08.142 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.inCdata && (isStyle)) {
2022-09-14 17:25:08.143 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:08.971 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:12.170 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.inCdata || (isStyle)) {
2022-09-14 17:25:12.170 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:12.884 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:15.852 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.inCdata && (isStyle)) {
2022-09-14 17:25:15.852 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:16.580 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:19.797 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:25:31.780 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.inCdata || (isStyle)) {
2022-09-14 17:25:31.781 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:32.509 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:35.698 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.preserveComments && (isStyle)) {
2022-09-14 17:25:35.698 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:36.371 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:39.355 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.preserveComments || (isStyle)) {
2022-09-14 17:25:39.355 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:40.074 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:43.244 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.preserveComments && (isStyle)) {
2022-09-14 17:25:43.244 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:43.920 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:25:46.962 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:25:58.913 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.preserveComments || (isStyle)) {
2022-09-14 17:25:58.913 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:25:59.648 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:26:02.727 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.externalCssScanner && (isStyle)) {
2022-09-14 17:26:02.727 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:26:03.403 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:26:06.646 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle != this.externalCssScanner || (isStyle)) {
2022-09-14 17:26:06.646 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:26:07.363 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:26:10.425 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.externalCssScanner && (isStyle)) {
2022-09-14 17:26:10.426 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:26:11.113 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:26:14.105 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:26:25.596 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (isStyle == this.externalCssScanner || (isStyle)) {
2022-09-14 17:26:25.596 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:26:26.257 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:26:29.455 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (masqueradingParam) {
2022-09-14 17:26:29.455 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:26:30.184 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:26:33.359 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:26:44.997 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (this.isNofollowAnchors) {
2022-09-14 17:26:44.997 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:26:45.700 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:26:48.869 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (this.isValidateParamAsEmbed) {
2022-09-14 17:26:48.869 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:26:49.563 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:26:52.834 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (this.inCdata) {
2022-09-14 17:26:52.834 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:26:53.518 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:26:56.648 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:27:07.767 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (this.preserveComments) {
2022-09-14 17:27:07.767 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:27:08.420 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:27:11.575 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:27:23.110 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (this.externalCssScanner) {
2022-09-14 17:27:23.110 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:27:23.797 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:27:26.862 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:27:38.070 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (peekTop()) {
2022-09-14 17:27:38.070 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:27:38.687 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - BuggyProject ---Fixer: fix fail because of failed compiling! 
2022-09-14 17:27:38.694 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (makeCssScanner()) {
2022-09-14 17:27:38.694 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:27:39.381 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - BuggyProject ---Fixer: fix fail because of failed compiling! 
2022-09-14 17:27:39.388 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,7 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
+			if (getErrorMessages()) {
2022-09-14 17:27:39.388 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:27:39.989 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - BuggyProject ---Fixer: fix fail because of failed compiling! 
2022-09-14 17:27:40.076 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,14 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
-				this.operations.push(Ops.CSS);
-				cssContent = new StringBuffer();
-				cssAttributes = attributes;
-			} else {
-				// validate all attributes, we need to do this now to find out
-				// how to deal with the element
-				boolean removeTag = false;
+			boolean removeTag = false;
@@ -368,7 +361,6 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			}
2022-09-14 17:27:40.076 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:27:40.788 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:27:44.062 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test the whole test suite.
2022-09-14 17:27:55.749 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,104 +271,9 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
-				this.operations.push(Ops.CSS);
+			this.operations.push(Ops.CSS);
-			} else {
-				// validate all attributes, we need to do this now to find out
-				// how to deal with the element
-				boolean removeTag = false;
-				boolean filterTag = false;
-				for (int i = 0; i < attributes.getLength(); i++) {
-					String name = attributes.getQName(i);
-					String value = attributes.getValue(i);
-					String nameLower = name.toLowerCase();
-					Attribute attribute = tag.getAttributeByName(nameLower);
-					if (attribute == null) {
-						// no policy defined, perhaps it is a global attribute
-						attribute = policy.getGlobalAttributeByName(nameLower);
-					}
-					// boolean isAttributeValid = false;
-					if ("style".equalsIgnoreCase(name)) {
-						CssScanner styleScanner = makeCssScanner();
-						try {
-							CleanResults cr = styleScanner.scanInlineStyle(value, element.localpart, maxInputSize);
-							attributes.setValue(i, cr.getCleanHTML());
-							validattributes.addAttribute(makeSimpleQname(name), "CDATA", cr.getCleanHTML());
-							errorMessages.addAll(cr.getErrorMessages());
-						} catch (ScanException e) {
-							addError(ErrorMessageUtil.ERROR_CSS_ATTRIBUTE_MALFORMED, new Object[] {
-									element.localpart, HTMLEntityEncoder.htmlEntityEncode(value)
-							});
-						}
-					} else if (attribute != null) {
-						// validate the values against the policy
-						boolean isValid = false;
-                        if (attribute.containsAllowedValue(value.toLowerCase())) {
-                            validattributes.addAttribute(makeSimpleQname(name), "CDATA", value);
-                            isValid = true;
-                        }
-
-
-                        if (!isValid) {
-                            isValid = attribute.matchesAllowedExpression(value);
-                            if (isValid) {
-                                validattributes.addAttribute(makeSimpleQname(name), "CDATA", value);
-                            }
-                        }
-
-
-                        // if value or regexp matched, attribute is already
-						// copied, but what happens if not
-						if (!isValid && "removeTag".equals(attribute.getOnInvalid())) {
-
-							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_INVALID_REMOVED,
-								new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
-
-							removeTag = true;
-
-						} else if (!isValid && ("filterTag".equals(attribute.getOnInvalid()) || masqueradingParam)) {
-
-							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_CAUSE_FILTER,
-								new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
-
-							filterTag = true;
-
-						} else if (!isValid) {
-							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_INVALID, new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
-						}
-
-					} else { // attribute == null
-						addError(ErrorMessageUtil.ERROR_ATTRIBUTE_NOT_IN_POLICY, new Object[] {
-								element.localpart, HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value)
-						});
-
-						if (masqueradingParam) {
-							filterTag = true;
-						}
-					}
-				}
-
-				if (removeTag) {
-					this.operations.push(Ops.REMOVE);
-				} else if (filterTag) {
-					this.operations.push(Ops.FILTER);
-				} else {
-
-					if (isNofollowAnchors && "a".equals(element.localpart)) {
-						validattributes.addAttribute(makeSimpleQname("rel"), "CDATA", "nofollow");
-					}
-
-					if (masqueradingParam) {
-						validattributes = new XMLAttributesImpl();
-						validattributes.addAttribute(makeSimpleQname("name"), "CDATA", embedName);
-						validattributes.addAttribute(makeSimpleQname("value"), "CDATA", embedValue);
-					}
-
-					this.operations.push(Ops.KEEP);
-				}
-			}
2022-09-14 17:27:55.749 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:27:56.408 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:27:59.535 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -271,104 +271,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-			if (isStyle) {
-				this.operations.push(Ops.CSS);
-				cssContent = new StringBuffer();
-				cssAttributes = attributes;
-			} else {
-				// validate all attributes, we need to do this now to find out
-				// how to deal with the element
-				boolean removeTag = false;
-				boolean filterTag = false;
-				for (int i = 0; i < attributes.getLength(); i++) {
-					String name = attributes.getQName(i);
-					String value = attributes.getValue(i);
-					String nameLower = name.toLowerCase();
-					Attribute attribute = tag.getAttributeByName(nameLower);
-					if (attribute == null) {
-						// no policy defined, perhaps it is a global attribute
-						attribute = policy.getGlobalAttributeByName(nameLower);
-					}
-					// boolean isAttributeValid = false;
-					if ("style".equalsIgnoreCase(name)) {
-						CssScanner styleScanner = makeCssScanner();
-						try {
-							CleanResults cr = styleScanner.scanInlineStyle(value, element.localpart, maxInputSize);
-							attributes.setValue(i, cr.getCleanHTML());
-							validattributes.addAttribute(makeSimpleQname(name), "CDATA", cr.getCleanHTML());
-							errorMessages.addAll(cr.getErrorMessages());
-						} catch (ScanException e) {
-							addError(ErrorMessageUtil.ERROR_CSS_ATTRIBUTE_MALFORMED, new Object[] {
-									element.localpart, HTMLEntityEncoder.htmlEntityEncode(value)
-							});
-						}
-					} else if (attribute != null) {
-						// validate the values against the policy
-						boolean isValid = false;
-                        if (attribute.containsAllowedValue(value.toLowerCase())) {
-                            validattributes.addAttribute(makeSimpleQname(name), "CDATA", value);
-                            isValid = true;
-                        }
-
-
-                        if (!isValid) {
-                            isValid = attribute.matchesAllowedExpression(value);
-                            if (isValid) {
-                                validattributes.addAttribute(makeSimpleQname(name), "CDATA", value);
-                            }
-                        }
-
-
-                        // if value or regexp matched, attribute is already
-						// copied, but what happens if not
-						if (!isValid && "removeTag".equals(attribute.getOnInvalid())) {
-
-							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_INVALID_REMOVED,
-								new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
-
-							removeTag = true;
-
-						} else if (!isValid && ("filterTag".equals(attribute.getOnInvalid()) || masqueradingParam)) {
-
-							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_CAUSE_FILTER,
-								new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
-
-							filterTag = true;
-
-						} else if (!isValid) {
-							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_INVALID, new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
-						}
-
-					} else { // attribute == null
-						addError(ErrorMessageUtil.ERROR_ATTRIBUTE_NOT_IN_POLICY, new Object[] {
-								element.localpart, HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value)
-						});
-
-						if (masqueradingParam) {
-							filterTag = true;
-						}
-					}
-				}
-
-				if (removeTag) {
-					this.operations.push(Ops.REMOVE);
-				} else if (filterTag) {
-					this.operations.push(Ops.FILTER);
-				} else {
-
-					if (isNofollowAnchors && "a".equals(element.localpart)) {
-						validattributes.addAttribute(makeSimpleQname("rel"), "CDATA", "nofollow");
-					}
-
-					if (masqueradingParam) {
-						validattributes = new XMLAttributesImpl();
-						validattributes.addAttribute(makeSimpleQname("name"), "CDATA", embedName);
-						validattributes.addAttribute(makeSimpleQname("value"), "CDATA", embedValue);
-					}
-
-					this.operations.push(Ops.KEEP);
-				}
-			}
+
2022-09-14 17:27:59.535 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:00.227 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:03.344 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -221,172 +221,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-	public void startElement(QName element, XMLAttributes attributes, Augmentations augs) throws XNIException {
-		// see if we have a policy for this tag.
-        String tagNameLowerCase = element.localpart.toLowerCase();
-        Tag tag = policy.getTagByLowercaseName(tagNameLowerCase);
-
-		/*
-		 * Handle the automatic translation of <param> to nested <embed> for IE.
-		 * This is only if the "validateParamAsEmbed" directive is enabled.
-		 */
-		boolean masqueradingParam = false;
-		String embedName = null;
-		String embedValue = null;
-		if (tag == null && isValidateParamAsEmbed && "param".equals(tagNameLowerCase)) {
-			Tag embedPolicy = policy.getEmbedTag();
-			if (embedPolicy != null && embedPolicy.isAction( Policy.ACTION_VALIDATE)) {
-				tag = embedPolicy;// Constants.BASIC_PARAM_TAG_RULE;
-				masqueradingParam = true;
-				// take <param name=x value=y> and turn into
-				// <embed x=y></embed>
-				embedName = attributes.getValue("name");
-				embedValue = attributes.getValue("value");
-				XMLAttributes masqueradingAttrs = new XMLAttributesImpl();
-				masqueradingAttrs.addAttribute(makeSimpleQname(embedName), "CDATA", embedValue);
-				attributes = masqueradingAttrs;
-			}
-		}
-
-		XMLAttributes validattributes = new XMLAttributesImpl();
-        Ops topOp = peekTop();
-        if (Ops.REMOVE == topOp || Ops.CSS == topOp) {
-			// we are in removal-mode, so remove this tag as well
-			// we also remove all child elements of a style element
-			this.operations.push( Ops.REMOVE);
-		} else if ((tag == null && policy.isEncodeUnknownTag()) || (tag != null && tag.isAction( "encode" ))) {
-			String name = "<" + element.localpart + ">";
-			super.characters( new XMLString( name.toCharArray(), 0, name.length() ), augs );
-			this.operations.push(Ops.FILTER);
-		} else if (tag == null) {
-			addError( ErrorMessageUtil.ERROR_TAG_NOT_IN_POLICY,
-                      new Object[]{ HTMLEntityEncoder.htmlEntityEncode( element.localpart ) } );
-			this.operations.push(Ops.FILTER);
-		} else if (tag.isAction( "filter")) {
-			addError(ErrorMessageUtil.ERROR_TAG_FILTERED, new Object[] {
-				HTMLEntityEncoder.htmlEntityEncode(element.localpart)
-			});
-			this.operations.push(Ops.FILTER);
-		} else if (tag.isAction( "validate")) {
-
-			boolean isStyle = "style".endsWith(element.localpart);
-
-			if (isStyle) {
-				this.operations.push(Ops.CSS);
-				cssContent = new StringBuffer();
-				cssAttributes = attributes;
-			} else {
-				// validate all attributes, we need to do this now to find out
-				// how to deal with the element
-				boolean removeTag = false;
-				boolean filterTag = false;
-				for (int i = 0; i < attributes.getLength(); i++) {
-					String name = attributes.getQName(i);
-					String value = attributes.getValue(i);
-					String nameLower = name.toLowerCase();
-					Attribute attribute = tag.getAttributeByName(nameLower);
-					if (attribute == null) {
-						// no policy defined, perhaps it is a global attribute
-						attribute = policy.getGlobalAttributeByName(nameLower);
-					}
-					// boolean isAttributeValid = false;
-					if ("style".equalsIgnoreCase(name)) {
-						CssScanner styleScanner = makeCssScanner();
-						try {
-							CleanResults cr = styleScanner.scanInlineStyle(value, element.localpart, maxInputSize);
-							attributes.setValue(i, cr.getCleanHTML());
-							validattributes.addAttribute(makeSimpleQname(name), "CDATA", cr.getCleanHTML());
-							errorMessages.addAll(cr.getErrorMessages());
-						} catch (ScanException e) {
-							addError(ErrorMessageUtil.ERROR_CSS_ATTRIBUTE_MALFORMED, new Object[] {
-									element.localpart, HTMLEntityEncoder.htmlEntityEncode(value)
-							});
-						}
-					} else if (attribute != null) {
-						// validate the values against the policy
-						boolean isValid = false;
-                        if (attribute.containsAllowedValue(value.toLowerCase())) {
-                            validattributes.addAttribute(makeSimpleQname(name), "CDATA", value);
-                            isValid = true;
-                        }
-
-
-                        if (!isValid) {
-                            isValid = attribute.matchesAllowedExpression(value);
-                            if (isValid) {
-                                validattributes.addAttribute(makeSimpleQname(name), "CDATA", value);
-                            }
-                        }
-
-
-                        // if value or regexp matched, attribute is already
-						// copied, but what happens if not
-						if (!isValid && "removeTag".equals(attribute.getOnInvalid())) {
-
-							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_INVALID_REMOVED,
-								new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
-
-							removeTag = true;
-
-						} else if (!isValid && ("filterTag".equals(attribute.getOnInvalid()) || masqueradingParam)) {
-
-							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_CAUSE_FILTER,
-								new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
-
-							filterTag = true;
-
-						} else if (!isValid) {
-							addError(ErrorMessageUtil.ERROR_ATTRIBUTE_INVALID, new Object[] { tag.getName(), HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value) });
-						}
-
-					} else { // attribute == null
-						addError(ErrorMessageUtil.ERROR_ATTRIBUTE_NOT_IN_POLICY, new Object[] {
-								element.localpart, HTMLEntityEncoder.htmlEntityEncode(name), HTMLEntityEncoder.htmlEntityEncode(value)
-						});
-
-						if (masqueradingParam) {
-							filterTag = true;
-						}
-					}
-				}
-
-				if (removeTag) {
-					this.operations.push(Ops.REMOVE);
-				} else if (filterTag) {
-					this.operations.push(Ops.FILTER);
-				} else {
-
-					if (isNofollowAnchors && "a".equals(element.localpart)) {
-						validattributes.addAttribute(makeSimpleQname("rel"), "CDATA", "nofollow");
-					}
-
-					if (masqueradingParam) {
-						validattributes = new XMLAttributesImpl();
-						validattributes.addAttribute(makeSimpleQname("name"), "CDATA", embedName);
-						validattributes.addAttribute(makeSimpleQname("value"), "CDATA", embedValue);
-					}
-
-					this.operations.push(Ops.KEEP);
-				}
-			}
-		} else if (tag.isAction( "truncate")) {
-			this.operations.push(Ops.TRUNCATE);
-		} else {
-			// no options left, so the tag will be removed
-			addError(ErrorMessageUtil.ERROR_TAG_DISALLOWED, new Object[] {
-				HTMLEntityEncoder.htmlEntityEncode(element.localpart)
-			});
-			this.operations.push(Ops.REMOVE);
-		}
-		// now we know exactly what to do, let's do it
-		if ( Ops.TRUNCATE.equals( operations.peek() )) {
-			// copy the element, but remove all attributes
-			super.startElement(element, new XMLAttributesImpl(), augs);
-		} else if ( Ops.KEEP.equals(operations.peek())) {
-			// copy the element, but only copy accepted attributes
-			super.startElement(element, validattributes, augs);
-		}
-	}
+
2022-09-14 17:28:03.344 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:04.057 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:07.486 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - org.owasp.validator.html.scan.MagicSAXFilter ===353
2022-09-14 17:28:07.515 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Suspicious Code: 
if (removeTag) {
					this.operations.push(Ops.REMOVE);
				} else if (filterTag) {
					this.operations.push(Ops.FILTER);
				} else {

					if (isNofollowAnchors && "a".equals(element.localpart)) {
						validattributes.addAttribute(makeSimpleQname("rel"), "CDATA", "nofollow");
					}

					if (masqueradingParam) {
						validattributes = new XMLAttributesImpl();
						validattributes.addAttribute(makeSimpleQname("name"), "CDATA", embedName);
						validattributes.addAttribute(makeSimpleQname("value"), "CDATA", embedValue);
					}

					this.operations.push(Ops.KEEP);
				}
2022-09-14 17:28:07.542 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != filterTag && (removeTag)) {
2022-09-14 17:28:07.542 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:08.269 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:11.461 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != filterTag || (removeTag)) {
2022-09-14 17:28:11.461 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:12.160 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:15.296 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == filterTag && (removeTag)) {
2022-09-14 17:28:15.296 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:15.956 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:19.268 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == filterTag || (removeTag)) {
2022-09-14 17:28:19.268 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:19.919 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:23.066 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != isStyle && (removeTag)) {
2022-09-14 17:28:23.066 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:23.805 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:26.972 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != isStyle || (removeTag)) {
2022-09-14 17:28:26.972 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:27.616 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:30.880 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == isStyle && (removeTag)) {
2022-09-14 17:28:30.881 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:31.531 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:34.642 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == isStyle || (removeTag)) {
2022-09-14 17:28:34.642 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:35.406 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:38.608 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != masqueradingParam && (removeTag)) {
2022-09-14 17:28:38.608 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:39.311 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:42.176 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != masqueradingParam || (removeTag)) {
2022-09-14 17:28:42.176 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:42.774 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:45.711 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == masqueradingParam && (removeTag)) {
2022-09-14 17:28:45.711 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:46.376 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:49.482 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == masqueradingParam || (removeTag)) {
2022-09-14 17:28:49.482 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:50.118 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:53.204 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.isNofollowAnchors && (removeTag)) {
2022-09-14 17:28:53.204 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:53.976 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:28:57.305 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.isNofollowAnchors || (removeTag)) {
2022-09-14 17:28:57.305 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:28:58.061 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:01.137 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.isNofollowAnchors && (removeTag)) {
2022-09-14 17:29:01.138 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:01.793 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:05.102 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.isNofollowAnchors || (removeTag)) {
2022-09-14 17:29:05.102 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:05.890 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:09.210 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.isValidateParamAsEmbed && (removeTag)) {
2022-09-14 17:29:09.210 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:09.917 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:13.000 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.isValidateParamAsEmbed || (removeTag)) {
2022-09-14 17:29:13.000 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:13.629 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:16.710 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.isValidateParamAsEmbed && (removeTag)) {
2022-09-14 17:29:16.710 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:17.340 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:20.504 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.isValidateParamAsEmbed || (removeTag)) {
2022-09-14 17:29:20.504 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:21.146 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:24.168 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.inCdata && (removeTag)) {
2022-09-14 17:29:24.168 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:24.837 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:28.021 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.inCdata || (removeTag)) {
2022-09-14 17:29:28.021 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:28.714 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:31.767 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.inCdata && (removeTag)) {
2022-09-14 17:29:31.767 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:32.457 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:35.469 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.inCdata || (removeTag)) {
2022-09-14 17:29:35.469 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:36.209 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:39.446 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.preserveComments && (removeTag)) {
2022-09-14 17:29:39.446 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:40.143 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:43.329 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.preserveComments || (removeTag)) {
2022-09-14 17:29:43.329 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:44.084 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:47.457 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.preserveComments && (removeTag)) {
2022-09-14 17:29:47.457 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:48.137 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:51.171 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.preserveComments || (removeTag)) {
2022-09-14 17:29:51.171 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:51.875 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:55.010 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.externalCssScanner && (removeTag)) {
2022-09-14 17:29:55.010 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:55.711 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:29:58.846 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag != this.externalCssScanner || (removeTag)) {
2022-09-14 17:29:58.846 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:29:59.414 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:02.637 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.externalCssScanner && (removeTag)) {
2022-09-14 17:30:02.637 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:03.335 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:06.529 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (removeTag == this.externalCssScanner || (removeTag)) {
2022-09-14 17:30:06.529 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:07.200 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:10.258 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (filterTag) {
2022-09-14 17:30:10.258 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:11.072 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:14.310 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (isStyle) {
2022-09-14 17:30:14.310 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:14.973 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:18.225 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (masqueradingParam) {
2022-09-14 17:30:18.225 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:18.892 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:22.004 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (this.isNofollowAnchors) {
2022-09-14 17:30:22.004 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:22.694 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:25.763 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (this.isValidateParamAsEmbed) {
2022-09-14 17:30:25.763 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:26.434 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:29.731 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (this.inCdata) {
2022-09-14 17:30:29.731 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:30.402 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:33.338 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (this.preserveComments) {
2022-09-14 17:30:33.338 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:34.002 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:37.239 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (this.externalCssScanner) {
2022-09-14 17:30:37.239 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:37.979 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:41.076 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (peekTop()) {
2022-09-14 17:30:41.077 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:41.667 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - BuggyProject ---Fixer: fix fail because of failed compiling! 
2022-09-14 17:30:41.673 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (makeCssScanner()) {
2022-09-14 17:30:41.673 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:42.187 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - BuggyProject ---Fixer: fix fail because of failed compiling! 
2022-09-14 17:30:42.203 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,7 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
+				if (getErrorMessages()) {
2022-09-14 17:30:42.204 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:42.803 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - BuggyProject ---Fixer: fix fail because of failed compiling! 
2022-09-14 17:30:42.898 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,9 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
-					this.operations.push(Ops.REMOVE);
-				} else if (filterTag) {
+				if (filterTag) {
2022-09-14 17:30:42.898 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:43.592 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:46.638 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,24 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
-					this.operations.push(Ops.REMOVE);
-				} else if (filterTag) {
-					this.operations.push(Ops.FILTER);
-				} else {
-
-					if (isNofollowAnchors && "a".equals(element.localpart)) {
-						validattributes.addAttribute(makeSimpleQname("rel"), "CDATA", "nofollow");
-					}
-
-					if (masqueradingParam) {
-						validattributes = new XMLAttributesImpl();
-						validattributes.addAttribute(makeSimpleQname("name"), "CDATA", embedName);
-						validattributes.addAttribute(makeSimpleQname("value"), "CDATA", embedValue);
-					}
-
-					this.operations.push(Ops.KEEP);
-				}
+				this.operations.push(Ops.REMOVE);
2022-09-14 17:30:46.638 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:47.303 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:50.443 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Patch Candidate:
@@ -350,24 +350,7 @@ public class MagicSAXFilter extends DefaultFilter implements XMLDocumentFilter {
-				if (removeTag) {
-					this.operations.push(Ops.REMOVE);
-				} else if (filterTag) {
-					this.operations.push(Ops.FILTER);
-				} else {
-
-					if (isNofollowAnchors && "a".equals(element.localpart)) {
-						validattributes.addAttribute(makeSimpleQname("rel"), "CDATA", "nofollow");
-					}
-
-					if (masqueradingParam) {
-						validattributes = new XMLAttributesImpl();
-						validattributes.addAttribute(makeSimpleQname("name"), "CDATA", embedName);
-						validattributes.addAttribute(makeSimpleQname("value"), "CDATA", embedValue);
-					}
-
-					this.operations.push(Ops.KEEP);
-				}
+
2022-09-14 17:30:50.443 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Compiling
2022-09-14 17:30:51.175 [main] DEBUG edu.lu.uni.serval.tbar.AbstractFixer - Test previously failed test cases.
2022-09-14 17:30:54.085 [main] INFO  edu.lu.uni.serval.tbar.TBarFixer - =======StaticBugFixer: Finish off fixing======
Failed to fix bug


Node: ee2bf67284b9



Date: Wed Sep 14 17:30:54 EDT 2022

